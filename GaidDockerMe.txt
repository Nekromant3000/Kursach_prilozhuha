Полный гайд по Docker для вашего проекта
Шаг 1: Установка Docker
1.1 Скачайте Docker Desktop
Перейдите на официальный сайт: https://www.docker.com/products/docker-desktop/

Нажмите "Download for Windows"

Загрузите установщик Docker Desktop

1.2 Установите Docker Desktop
Запустите скачанный установщик

Следуйте инструкциям установщика

После установки перезагрузите компьютер

Запустите Docker Desktop

1.3 Проверьте установку
Откройте PowerShell или командную строку:

bash
docker --version
docker-compose --version
Вы должны увидеть версии Docker.

Шаг 2: Подготовка проекта
2.1 Структура папок
Убедитесь, что у вас такая структура:

text
kursach/
├── backend/      (бэкенд)
├── frontend/     (фронтенд)
└── docker-compose.yml (будет создан)
2.2 Удалите старые контейнеры (если есть)
bash
docker system prune -a
Шаг 3: Создание Docker-файлов
3.1 Создайте Dockerfile для бэкенда
В папке backend создайте файл Dockerfile (без расширения) с содержимым:

dockerfile
FROM python:3.11-slim

WORKDIR /app

# Устанавливаем системные зависимости
RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    && rm -rf /var/lib/apt/lists/*

# Копируем requirements.txt
COPY requirements.txt .

# Устанавливаем Python зависимости
RUN pip install --no-cache-dir --upgrade pip && \
    pip install --no-cache-dir -r requirements.txt

# Копируем весь проект
COPY . .

# Создаем точку входа
COPY entrypoint.sh .
RUN chmod +x entrypoint.sh

# Открываем порт
EXPOSE 8000

# Команда запуска
CMD ["sh", "entrypoint.sh"]
3.2 Создайте entrypoint.sh для бэкенда
В той же папке backend создайте файл entrypoint.sh:

bash
#!/bin/bash

# Ждем, пока база данных будет готова
echo "Ожидание инициализации базы данных..."

# Создаем таблицы если нужно
python init_db.py

# Запускаем приложение
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
3.3 Создайте Dockerfile для фронтенда
В папке frontend создайте файл Dockerfile:

dockerfile
FROM node:18-alpine

WORKDIR /app

# Копируем package.json
COPY package*.json ./

# Устанавливаем зависимости
RUN npm install

# Копируем исходный код
COPY . .

# Собираем проект
RUN npm run build

# Устанавливаем serve для раздачи статики
RUN npm install -g serve

# Открываем порт
EXPOSE 3000

# Команда запуска
CMD ["serve", "-s", "dist", "-l", "3000"]
3.4 Создайте docker-compose.yml в корневой папке
В папке kursach создайте файл docker-compose.yml:

yaml
version: '3.8'

services:
  backend:
    build: ./backend
    container_name: library_backend
    ports:
      - "8000:8000"
    volumes:
      - ./backend:/app
      - ./backend/library.db:/app/library.db
    environment:
      - DATABASE_URL=sqlite:///./library.db
    depends_on:
      - postgres  # удалите эту строку если используете SQLite
    networks:
      - library_network

  frontend:
    build: ./frontend
    container_name: library_frontend
    ports:
      - "3000:3000"
    volumes:
      - ./frontend:/app
      - /app/node_modules
    depends_on:
      - backend
    networks:
      - library_network

  # Если хотите использовать PostgreSQL вместо SQLite, раскомментируйте:
  # postgres:
  #   image: postgres:15-alpine
  #   container_name: library_db
  #   ports:
  #     - "5432:5432"
  #   environment:
  #     - POSTGRES_USER=library_user
  #     - POSTGRES_PASSWORD=library_password
  #     - POSTGRES_DB=library_db
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   networks:
  #     - library_network

networks:
  library_network:
    driver: bridge

# Раскомментируйте если используете PostgreSQL:
# volumes:
#   postgres_data:
3.5 Обновите requirements.txt для бэкенда
В папке backend создайте/обновите requirements.txt:

txt
fastapi==0.104.1
uvicorn[standard]==0.24.0
sqlalchemy==2.0.23
python-jose[cryptography]==3.3.0
passlib[bcrypt]==1.7.4
python-multipart==0.0.6
pydantic==2.5.0
email-validator==2.1.0
Шаг 4: Подготовка исходного кода
4.1 Создайте минимальный main.py для теста
В папке backend создайте main.py:

python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI(title="Library API")

# Настройка CORS
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000", "http://frontend:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

@app.get("/")
def read_root():
    return {"message": "Library API is running!"}

@app.get("/health")
def health_check():
    return {"status": "healthy"}
4.2 Создайте init_db.py
В папке backend создайте init_db.py:

python
from database import Base, engine

print("Создание таблиц в базе данных...")
Base.metadata.create_all(bind=engine)
print("Таблицы созданы!")
4.3 Создайте database.py
В папке backend создайте database.py:

python
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
import os

# Для SQLite
SQLALCHEMY_DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./library.db")

engine = create_engine(
    SQLALCHEMY_DATABASE_URL,
    connect_args={"check_same_thread": False} if "sqlite" in SQLALCHEMY_DATABASE_URL else {}
)

SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

Base = declarative_base()

def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
Шаг 5: Запуск проекта
5.1 Перейдите в корневую папку
bash
cd C:\Users\Student\Desktop\kursach
5.2 Соберите и запустите контейнеры
bash
docker-compose up --build
5.3 Проверьте работу
Откройте браузер и проверьте:

Бэкенд: http://localhost:8000

Бэкенд health: http://localhost:8000/health

Фронтенд: http://localhost:3000 (после настройки)

Шаг 6: Полезные команды Docker
Просмотр запущенных контейнеров:
bash
docker-compose ps
Остановка контейнеров:
bash
docker-compose down
Просмотр логов:
bash
# Все логи
docker-compose logs

# Логи конкретного сервиса
docker-compose logs backend
docker-compose logs frontend
Вход в контейнер:
bash
docker-compose exec backend bash
docker-compose exec frontend sh
Пересборка без кэша:
bash
docker-compose build --no-cache
Удаление всего:
bash
docker-compose down -v  # удаляет volumes
docker system prune -a  # очищает всё
Шаг 7: Решение проблем
Проблема 1: "Port is already allocated"
Остановите службы на портах 8000 и 3000:

bash
netstat -ano | findstr :8000
taskkill /PID <PID> /F
Проблема 2: "Build failed"
Проверьте логи:

bash
docker-compose build --no-cache
Проблема 3: "Permission denied"
Дайте права на выполнение:

bash
# В PowerShell
icacls "entrypoint.sh" /grant:r "Users:(RX)"
Шаг 8: Дополнительная настройка
8.1 Создайте .dockerignore
В папке backend создайте .dockerignore:

text
__pycache__
*.pyc
*.pyo
*.pyd
.Python
venv
env
*.db
*.sqlite3
.DS_Store
В папке frontend создайте .dockerignore:

text
node_modules
npm-debug.log
dist
.DS_Store
.env
8.2 Оптимизация для продакшена
Создайте docker-compose.prod.yml:

yaml
version: '3.8'

services:
  backend:
    build: 
      context: ./backend
      dockerfile: Dockerfile.prod
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=sqlite:///./library.db
      - PYTHONUNBUFFERED=1
    restart: always

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
    ports:
      - "80:3000"
    restart: always
Важные моменты:
Docker Desktop должен быть запущен перед выполнением команд

Все файлы должны быть в правильной кодировке (UTF-8 без BOM)

Для Windows используйте правильные пути (прямые слэши)

Если возникают проблемы с volume, проверьте настройки Docker Desktop:

File Sharing в Docker Desktop

Антивирусные исключения

Быстрый старт:
Установите Docker Desktop

Скопируйте файлы из этого гайда в свои папки

Откройте PowerShell в папке kursach

Выполните: docker-compose up --build

Откройте http://localhost:8000

Этот гайд позволит вам запустить проект в изолированной среде без проблем с версиями Python и зависимостями!